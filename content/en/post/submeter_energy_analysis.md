---
date: "00-00-0000"
description: ""
featured_image: "/images/submeter_feature.webp"
title: "Energy Consumption Analysis (R)"
show_reading_time: true
draft:
---
<!--
{{< typography font="Lato" size="18px" weight="" >}}

{{< /typography >}}

{{< figure src="/images/" >}}
-->

The goal of this project is to analyze energy consumption data over a three year span to provide evidence (if possible) supporting a client's claim that their residence was unoccupied during the summer (June-August) of 2008.

<!--
Questions from the client:

  1. What information is contained within the data records?
  2. Is the data complete? Is anything missing?
  3. What are the typical power usage patterns for this residence?
  4. Are these typical patterns true for the summer 2008? If not, what, if anything, can be used to help support the client’s claims?
  5. Are there any outliers or events in the data that may undermine the client’s claims?
  6. Are there any recommendations for questions we should be asking?
  7. Do you need anyy additional information to conduct the analysis?
-->



&nbsp;
#### *Dataset Info*

The energy consumption data is from January 2007 through December 2009 and was gathered from 3 submeters in a single family home located in Sceaux, France (nearly 2 million data points). Each submeter monitors energy consumption in a different area of the house:
  - *Submeter 1*: kitchen (dishwasher, oven and microwave)
  - *Submeter 2*: laundry room (washer, drier, and refrigerator)
  - *Submeter 3*: electric water heater and air conditioner.

I obtained the data from a __MySQL__ database.

<!--
  Notes:

   - (global_active_power*1000/60 - sub_metering_1 - sub_metering_2 - sub_metering_3) represents the active energy consumed every minute (in watt hour) by electrical equipment not measured in sub-meterings 1, 2 and 3.
   - The dataset contains some missing measurements (~ 1.25% of rows). All calendar timestamps are present but measurement values are missing for some: a missing value is represented by the absence of value between two consecutive semi-colon attribute separators (e.g. on April 28, 2007).


**Attribute Information**

  1. date: Date in format dd/mm/yyyy
  2. time: time in format hh:mm:ss
  3. global_active_power: household global minute-averaged active power (in kilowatt)
  4. global_reactive_power: household global minute-averaged reactive power (in kilowatt)
  5. voltage: minute-averaged voltage (in volt)
  6. global_intensity: household global minute-averaged current intensity (in ampere)
  sub meter variables: energy sub-metering (in watt-hour of active energy).     
  7. sub_metering_1: corresponds to the kitchen (dishwasher, oven and microwave)
  8. sub_metering_2: corresponds to the laundry room (contains a washing-machine, tumble-drier, refrigerator and a light)
  9. sub_metering_3: corresponds to an electric water-heater and an air-conditioner.



#### *Sub-meters* ####################################

Sub-meters provide room-by-room and/or appliance specific data about energy usage. In other words, a building/residence has a main/master meter that records the energy usage for the entire building/residence. Readings from main meters are what energy companies use for billing purposes. In addition to main meters, buildings/residences may also have sub-meters that just record energy usage from particular areas/rooms or applicances. Building managers and consumers typically use sub-meter data to get insight into and, perhaps improve, energy usage in particular areas.

-->

<!--

## Load Packages #################################


```r
#load pkgs
library(DBI) # for connecting to MySQL
library(tidyverse)
# tidyverse wouldn't install when typing in mannually, ran install.packages() in console then selected tidyverse from popup menu
library(janitor)

library(gghighlight)

# pkgs for working with time series data
library(lubridate) # wrangling date and time data
library(tsibble) # time series data representation (tibble-like)
library(feasts) # time series visualization
library(fable) # time series forecasting
```


## Get Data ###############################

```r
# create connection to MySQL database
con <-  dbConnect(RMariaDB::MariaDB(),
                user='deepAnalytics',
                password='Sqltask1234!',
                dbname='dataanalytics2018',
                host='data-analytics-2018.cbrosir2cswx.us-east-1.rds.amazonaws.com')
```

>*Reminder*: call dbDisconnect() when finished working with a connection



```r
# list tables contained in database
dbListTables(con)
```

```
## [1] "iris"    "yr_2006" "yr_2007" "yr_2008" "yr_2009" "yr_2010"
```

*2006*

```r
# list vars in yr_2006 table
dbListFields(con, 'yr_2006')
```

```
##  [1] "id"                    "Date"                  "Time"                 
##  [4] "Global_active_power"   "Global_reactive_power" "Global_intensity"     
##  [7] "Voltage"               "Sub_metering_1"        "Sub_metering_2"       
## [10] "Sub_metering_3"
```


```r
# import select vars from yr_2006
yr2006 <- dbGetQuery(con, 'SELECT Date, time, sub_metering_1, sub_metering_2, sub_metering_3 FROM yr_2006')

#check import
glimpse(yr2006)
```

```
## Rows: 21,992
## Columns: 5
## $ Date           <chr> "2006-12-16", "2006-12-16", "2006-12-16", "2006-12-16",~
## $ time           <chr> "17:24:00", "17:25:00", "17:26:00", "17:27:00", "17:28:~
## $ sub_metering_1 <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~
## $ sub_metering_2 <dbl> 1, 1, 2, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 0, 0, 0, 0~
## $ sub_metering_3 <dbl> 17, 16, 17, 17, 17, 17, 17, 17, 17, 16, 17, 17, 16, 17,~
```

*2007*

```r
# list vars in yr_2007 table
dbListFields(con, 'yr_2007')
```

```
##  [1] "id"                    "Date"                  "Time"                 
##  [4] "Global_active_power"   "Global_reactive_power" "Global_intensity"     
##  [7] "Voltage"               "Sub_metering_1"        "Sub_metering_2"       
## [10] "Sub_metering_3"
```


```r
# import select vars from yr 2007
yr2007 <- dbGetQuery(con, 'SELECT Date, Time, Sub_metering_1, Sub_metering_2, Sub_metering_3 FROM yr_2007')

#check import
glimpse(yr2007)
```

```
## Rows: 521,669
## Columns: 5
## $ Date           <chr> "2007-01-01", "2007-01-01", "2007-01-01", "2007-01-01",~
## $ Time           <chr> "00:00:00", "00:01:00", "00:02:00", "00:03:00", "00:04:~
## $ Sub_metering_1 <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~
## $ Sub_metering_2 <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~
## $ Sub_metering_3 <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~
```

```r
# since all showing submeter values are 0, perform additional check
unique(yr2007$Sub_metering_3)
```

```
##  [1]  0 16 18 17  9 12 19  5  1 14 15 13  4  6  8  7  3 11 10  2 20
```

*2008*

```r
# list var names for yr_2008
dbListFields(con, 'yr_2008')
```

```
##  [1] "id"                    "Date"                  "Time"                 
##  [4] "Global_active_power"   "Global_reactive_power" "Global_intensity"     
##  [7] "Voltage"               "Sub_metering_1"        "Sub_metering_2"       
## [10] "Sub_metering_3"
```


```r
# import select vars from yr 2008
yr2008 <- dbGetQuery(con, 'SELECT Date, Time, Sub_metering_1, Sub_metering_2, Sub_metering_3 FROM yr_2008')

#check import
glimpse(yr2008)
```

```
## Rows: 526,905
## Columns: 5
## $ Date           <chr> "2008-01-01", "2008-01-01", "2008-01-01", "2008-01-01",~
## $ Time           <chr> "00:00:00", "00:01:00", "00:02:00", "00:03:00", "00:04:~
## $ Sub_metering_1 <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~
## $ Sub_metering_2 <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~
## $ Sub_metering_3 <dbl> 18, 18, 18, 18, 18, 17, 18, 18, 18, 18, 18, 17, 18, 18,~
```

*2009*

```r
# list vars in yr 2009
dbListFields(con, 'yr_2009')
```

```
##  [1] "id"                    "Date"                  "Time"                 
##  [4] "Global_active_power"   "Global_reactive_power" "Global_intensity"     
##  [7] "Voltage"               "Sub_metering_1"        "Sub_metering_2"       
## [10] "Sub_metering_3"
```


```r
# import select vars from yr 2009
yr2009 <- dbGetQuery(con, 'SELECT Date, Time, Sub_metering_1, Sub_metering_2, Sub_metering_3 FROM yr_2009')

# check import
glimpse(yr2009)
```

```
## Rows: 521,320
## Columns: 5
## $ Date           <chr> "2009-01-01", "2009-01-01", "2009-01-01", "2009-01-01",~
## $ Time           <chr> "00:00:00", "00:01:00", "00:02:00", "00:03:00", "00:04:~
## $ Sub_metering_1 <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~
## $ Sub_metering_2 <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~
## $ Sub_metering_3 <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~
```

```r
#perform 2nd check b/c all showing values are 0
unique(yr2009$Sub_metering_3)
```

```
##  [1]  0 10 19 18 17  7  8  4 20 14  5  2 16  3  9  6 12 15 11 13  1 23 27 26 24
## [26] 22 21 25 28 29 30 31
```

*2010*

```r
# list vars in yr 2010
dbListFields(con, 'yr_2010')
```

```
##  [1] "id"                    "Date"                  "Time"                 
##  [4] "Global_active_power"   "Global_reactive_power" "Global_intensity"     
##  [7] "Voltage"               "Sub_metering_1"        "Sub_metering_2"       
## [10] "Sub_metering_3"
```


```r
# import select vars from yr_2010
yr2010 <- dbGetQuery(con, 'SELECT Date, Time, Sub_metering_1, Sub_metering_2, Sub_metering_3 FROM yr_2010')

# check import
glimpse(yr2010)
```

```
## Rows: 457,394
## Columns: 5
## $ Date           <chr> "2010-01-01", "2010-01-01", "2010-01-01", "2010-01-01",~
## $ Time           <chr> "00:00:00", "00:01:00", "00:02:00", "00:03:00", "00:04:~
## $ Sub_metering_1 <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~
## $ Sub_metering_2 <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~
## $ Sub_metering_3 <dbl> 18, 18, 19, 18, 18, 19, 18, 18, 19, 18, 19, 18, 18, 18,~
```

-->



&nbsp;
### DATA WRANGLING ################################
The database contained separate energy datasets for the years 2006 through 2010. Since I needed to look for evidence of an unusual dip in energy consumption in 2008, I only downloaded the data for 2007 - 2009.

<!--
## *Find Complete Datasets*

I only want to include datasets that have submeter readings for the full year. I'll check the unique values in "Date" column to determine which years are complete.  

*2006*

```r
#get unique values in date column
unique(yr2006$Date)
```

```
##  [1] "2006-12-16" "2006-12-17" "2006-12-18" "2006-12-19" "2006-12-20"
##  [6] "2006-12-21" "2006-12-22" "2006-12-23" "2006-12-24" "2006-12-25"
## [11] "2006-12-26" "2006-12-27" "2006-12-28" "2006-12-29" "2006-12-30"
## [16] "2006-12-31"
```
2006 data only covers part of December.


*2007*

```r
# get unique values in date
unique(yr2007$Date)
```

```
##   [1] "2007-01-01" "2007-01-02" "2007-01-03" "2007-01-04" "2007-01-05"
##   [6] "2007-01-06" "2007-01-07" "2007-01-08" "2007-01-09" "2007-01-10"
##  [11] "2007-01-11" "2007-01-12" "2007-01-13" "2007-01-14" "2007-01-15"
##  [16] "2007-01-16" "2007-01-17" "2007-01-18" "2007-01-19" "2007-01-20"
##  [21] "2007-01-21" "2007-01-22" "2007-01-23" "2007-01-24" "2007-01-25"
##  [26] "2007-01-26" "2007-01-27" "2007-01-28" "2007-01-29" "2007-01-30"
##  [31] "2007-01-31" "2007-02-01" "2007-02-02" "2007-02-03" "2007-02-04"
##  [36] "2007-02-05" "2007-02-06" "2007-02-07" "2007-02-08" "2007-02-09"
##  [41] "2007-02-10" "2007-02-11" "2007-02-12" "2007-02-13" "2007-02-14"
##  [46] "2007-02-15" "2007-02-16" "2007-02-17" "2007-02-18" "2007-02-19"
##  [51] "2007-02-20" "2007-02-21" "2007-02-22" "2007-02-23" "2007-02-24"
##  [56] "2007-02-25" "2007-02-26" "2007-02-27" "2007-02-28" "2007-03-01"
##  [61] "2007-03-02" "2007-03-03" "2007-03-04" "2007-03-05" "2007-03-06"
##  [66] "2007-03-07" "2007-03-08" "2007-03-09" "2007-03-10" "2007-03-11"
##  [71] "2007-03-12" "2007-03-13" "2007-03-14" "2007-03-15" "2007-03-16"
##  [76] "2007-03-17" "2007-03-18" "2007-03-19" "2007-03-20" "2007-03-21"
##  [81] "2007-03-22" "2007-03-23" "2007-03-24" "2007-03-25" "2007-03-26"
##  [86] "2007-03-27" "2007-03-28" "2007-03-29" "2007-03-30" "2007-03-31"
##  [91] "2007-04-01" "2007-04-02" "2007-04-03" "2007-04-04" "2007-04-05"
##  [96] "2007-04-06" "2007-04-07" "2007-04-08" "2007-04-09" "2007-04-10"
## [101] "2007-04-11" "2007-04-12" "2007-04-13" "2007-04-14" "2007-04-15"
## [106] "2007-04-16" "2007-04-17" "2007-04-18" "2007-04-19" "2007-04-20"
## [111] "2007-04-21" "2007-04-22" "2007-04-23" "2007-04-24" "2007-04-25"
## [116] "2007-04-26" "2007-04-27" "2007-04-28" "2007-04-30" "2007-05-01"
## [121] "2007-05-02" "2007-05-03" "2007-05-04" "2007-05-05" "2007-05-06"
## [126] "2007-05-07" "2007-05-08" "2007-05-09" "2007-05-10" "2007-05-11"
## [131] "2007-05-12" "2007-05-13" "2007-05-14" "2007-05-15" "2007-05-16"
## [136] "2007-05-17" "2007-05-18" "2007-05-19" "2007-05-20" "2007-05-21"
## [141] "2007-05-22" "2007-05-23" "2007-05-24" "2007-05-25" "2007-05-26"
## [146] "2007-05-27" "2007-05-28" "2007-05-29" "2007-05-30" "2007-05-31"
## [151] "2007-06-01" "2007-06-02" "2007-06-03" "2007-06-04" "2007-06-05"
## [156] "2007-06-06" "2007-06-07" "2007-06-08" "2007-06-09" "2007-06-10"
## [161] "2007-06-11" "2007-06-12" "2007-06-13" "2007-06-14" "2007-06-15"
## [166] "2007-06-16" "2007-06-17" "2007-06-18" "2007-06-19" "2007-06-20"
## [171] "2007-06-21" "2007-06-22" "2007-06-23" "2007-06-24" "2007-06-25"
## [176] "2007-06-26" "2007-06-27" "2007-06-28" "2007-06-29" "2007-06-30"
## [181] "2007-07-01" "2007-07-02" "2007-07-03" "2007-07-04" "2007-07-05"
## [186] "2007-07-06" "2007-07-07" "2007-07-08" "2007-07-09" "2007-07-10"
## [191] "2007-07-11" "2007-07-12" "2007-07-13" "2007-07-14" "2007-07-15"
## [196] "2007-07-16" "2007-07-17" "2007-07-18" "2007-07-19" "2007-07-20"
## [201] "2007-07-21" "2007-07-22" "2007-07-23" "2007-07-24" "2007-07-25"
## [206] "2007-07-26" "2007-07-27" "2007-07-28" "2007-07-29" "2007-07-30"
## [211] "2007-07-31" "2007-08-01" "2007-08-02" "2007-08-03" "2007-08-04"
## [216] "2007-08-05" "2007-08-06" "2007-08-07" "2007-08-08" "2007-08-09"
## [221] "2007-08-10" "2007-08-11" "2007-08-12" "2007-08-13" "2007-08-14"
## [226] "2007-08-15" "2007-08-16" "2007-08-17" "2007-08-18" "2007-08-19"
## [231] "2007-08-20" "2007-08-21" "2007-08-22" "2007-08-23" "2007-08-24"
## [236] "2007-08-25" "2007-08-26" "2007-08-27" "2007-08-28" "2007-08-29"
## [241] "2007-08-30" "2007-08-31" "2007-09-01" "2007-09-02" "2007-09-03"
## [246] "2007-09-04" "2007-09-05" "2007-09-06" "2007-09-07" "2007-09-08"
## [251] "2007-09-09" "2007-09-10" "2007-09-11" "2007-09-12" "2007-09-13"
## [256] "2007-09-14" "2007-09-15" "2007-09-16" "2007-09-17" "2007-09-18"
## [261] "2007-09-19" "2007-09-20" "2007-09-21" "2007-09-22" "2007-09-23"
## [266] "2007-09-24" "2007-09-25" "2007-09-26" "2007-09-27" "2007-09-28"
## [271] "2007-09-29" "2007-09-30" "2007-10-01" "2007-10-02" "2007-10-03"
## [276] "2007-10-04" "2007-10-05" "2007-10-06" "2007-10-07" "2007-10-08"
## [281] "2007-10-09" "2007-10-10" "2007-10-11" "2007-10-12" "2007-10-13"
## [286] "2007-10-14" "2007-10-15" "2007-10-16" "2007-10-17" "2007-10-18"
## [291] "2007-10-19" "2007-10-20" "2007-10-21" "2007-10-22" "2007-10-23"
## [296] "2007-10-24" "2007-10-25" "2007-10-26" "2007-10-27" "2007-10-28"
## [301] "2007-10-29" "2007-10-30" "2007-10-31" "2007-11-01" "2007-11-02"
## [306] "2007-11-03" "2007-11-04" "2007-11-05" "2007-11-06" "2007-11-07"
## [311] "2007-11-08" "2007-11-09" "2007-11-10" "2007-11-11" "2007-11-12"
## [316] "2007-11-13" "2007-11-14" "2007-11-15" "2007-11-16" "2007-11-17"
## [321] "2007-11-18" "2007-11-19" "2007-11-20" "2007-11-21" "2007-11-22"
## [326] "2007-11-23" "2007-11-24" "2007-11-25" "2007-11-26" "2007-11-27"
## [331] "2007-11-28" "2007-11-29" "2007-11-30" "2007-12-01" "2007-12-02"
## [336] "2007-12-03" "2007-12-04" "2007-12-05" "2007-12-06" "2007-12-07"
## [341] "2007-12-08" "2007-12-09" "2007-12-10" "2007-12-11" "2007-12-12"
## [346] "2007-12-13" "2007-12-14" "2007-12-15" "2007-12-16" "2007-12-17"
## [351] "2007-12-18" "2007-12-19" "2007-12-20" "2007-12-21" "2007-12-22"
## [356] "2007-12-23" "2007-12-24" "2007-12-25" "2007-12-26" "2007-12-27"
## [361] "2007-12-28" "2007-12-29" "2007-12-30" "2007-12-31"
```
2007 data covers full year.


*2008*

```r
# get unique values in date
unique(yr2008$Date)
```

```
##   [1] "2008-01-01" "2008-01-02" "2008-01-03" "2008-01-04" "2008-01-05"
##   [6] "2008-01-06" "2008-01-07" "2008-01-08" "2008-01-09" "2008-01-10"
##  [11] "2008-01-11" "2008-01-12" "2008-01-13" "2008-01-14" "2008-01-15"
##  [16] "2008-01-16" "2008-01-17" "2008-01-18" "2008-01-19" "2008-01-20"
##  [21] "2008-01-21" "2008-01-22" "2008-01-23" "2008-01-24" "2008-01-25"
##  [26] "2008-01-26" "2008-01-27" "2008-01-28" "2008-01-29" "2008-01-30"
##  [31] "2008-01-31" "2008-02-01" "2008-02-02" "2008-02-03" "2008-02-04"
##  [36] "2008-02-05" "2008-02-06" "2008-02-07" "2008-02-08" "2008-02-09"
##  [41] "2008-02-10" "2008-02-11" "2008-02-12" "2008-02-13" "2008-02-14"
##  [46] "2008-02-15" "2008-02-16" "2008-02-17" "2008-02-18" "2008-02-19"
##  [51] "2008-02-20" "2008-02-21" "2008-02-22" "2008-02-23" "2008-02-24"
##  [56] "2008-02-25" "2008-02-26" "2008-02-27" "2008-02-28" "2008-02-29"
##  [61] "2008-03-01" "2008-03-02" "2008-03-03" "2008-03-04" "2008-03-05"
##  [66] "2008-03-06" "2008-03-07" "2008-03-08" "2008-03-09" "2008-03-10"
##  [71] "2008-03-11" "2008-03-12" "2008-03-13" "2008-03-14" "2008-03-15"
##  [76] "2008-03-16" "2008-03-17" "2008-03-18" "2008-03-19" "2008-03-20"
##  [81] "2008-03-21" "2008-03-22" "2008-03-23" "2008-03-24" "2008-03-25"
##  [86] "2008-03-26" "2008-03-27" "2008-03-28" "2008-03-29" "2008-03-30"
##  [91] "2008-03-31" "2008-04-01" "2008-04-02" "2008-04-03" "2008-04-04"
##  [96] "2008-04-05" "2008-04-06" "2008-04-07" "2008-04-08" "2008-04-09"
## [101] "2008-04-10" "2008-04-11" "2008-04-12" "2008-04-13" "2008-04-14"
## [106] "2008-04-15" "2008-04-16" "2008-04-17" "2008-04-18" "2008-04-19"
## [111] "2008-04-20" "2008-04-21" "2008-04-22" "2008-04-23" "2008-04-24"
## [116] "2008-04-25" "2008-04-26" "2008-04-27" "2008-04-28" "2008-04-29"
## [121] "2008-04-30" "2008-05-01" "2008-05-02" "2008-05-03" "2008-05-04"
## [126] "2008-05-05" "2008-05-06" "2008-05-07" "2008-05-08" "2008-05-09"
## [131] "2008-05-10" "2008-05-11" "2008-05-12" "2008-05-13" "2008-05-14"
## [136] "2008-05-15" "2008-05-16" "2008-05-17" "2008-05-18" "2008-05-19"
## [141] "2008-05-20" "2008-05-21" "2008-05-22" "2008-05-23" "2008-05-24"
## [146] "2008-05-25" "2008-05-26" "2008-05-27" "2008-05-28" "2008-05-29"
## [151] "2008-05-30" "2008-05-31" "2008-06-01" "2008-06-02" "2008-06-03"
## [156] "2008-06-04" "2008-06-05" "2008-06-06" "2008-06-07" "2008-06-08"
## [161] "2008-06-09" "2008-06-10" "2008-06-11" "2008-06-12" "2008-06-13"
## [166] "2008-06-14" "2008-06-15" "2008-06-16" "2008-06-17" "2008-06-18"
## [171] "2008-06-19" "2008-06-20" "2008-06-21" "2008-06-22" "2008-06-23"
## [176] "2008-06-24" "2008-06-25" "2008-06-26" "2008-06-27" "2008-06-28"
## [181] "2008-06-29" "2008-06-30" "2008-07-01" "2008-07-02" "2008-07-03"
## [186] "2008-07-04" "2008-07-05" "2008-07-06" "2008-07-07" "2008-07-08"
## [191] "2008-07-09" "2008-07-10" "2008-07-11" "2008-07-12" "2008-07-13"
## [196] "2008-07-14" "2008-07-15" "2008-07-16" "2008-07-17" "2008-07-18"
## [201] "2008-07-19" "2008-07-20" "2008-07-21" "2008-07-22" "2008-07-23"
## [206] "2008-07-24" "2008-07-25" "2008-07-26" "2008-07-27" "2008-07-28"
## [211] "2008-07-29" "2008-07-30" "2008-07-31" "2008-08-01" "2008-08-02"
## [216] "2008-08-03" "2008-08-04" "2008-08-05" "2008-08-06" "2008-08-07"
## [221] "2008-08-08" "2008-08-09" "2008-08-10" "2008-08-11" "2008-08-12"
## [226] "2008-08-13" "2008-08-14" "2008-08-15" "2008-08-16" "2008-08-17"
## [231] "2008-08-18" "2008-08-19" "2008-08-20" "2008-08-21" "2008-08-22"
## [236] "2008-08-23" "2008-08-24" "2008-08-25" "2008-08-26" "2008-08-27"
## [241] "2008-08-28" "2008-08-29" "2008-08-30" "2008-08-31" "2008-09-01"
## [246] "2008-09-02" "2008-09-03" "2008-09-04" "2008-09-05" "2008-09-06"
## [251] "2008-09-07" "2008-09-08" "2008-09-09" "2008-09-10" "2008-09-11"
## [256] "2008-09-12" "2008-09-13" "2008-09-14" "2008-09-15" "2008-09-16"
## [261] "2008-09-17" "2008-09-18" "2008-09-19" "2008-09-20" "2008-09-21"
## [266] "2008-09-22" "2008-09-23" "2008-09-24" "2008-09-25" "2008-09-26"
## [271] "2008-09-27" "2008-09-28" "2008-09-29" "2008-09-30" "2008-10-01"
## [276] "2008-10-02" "2008-10-03" "2008-10-04" "2008-10-05" "2008-10-06"
## [281] "2008-10-07" "2008-10-08" "2008-10-09" "2008-10-10" "2008-10-11"
## [286] "2008-10-12" "2008-10-13" "2008-10-14" "2008-10-15" "2008-10-16"
## [291] "2008-10-17" "2008-10-18" "2008-10-19" "2008-10-20" "2008-10-21"
## [296] "2008-10-22" "2008-10-23" "2008-10-24" "2008-10-25" "2008-10-26"
## [301] "2008-10-27" "2008-10-28" "2008-10-29" "2008-10-30" "2008-10-31"
## [306] "2008-11-01" "2008-11-02" "2008-11-03" "2008-11-04" "2008-11-05"
## [311] "2008-11-06" "2008-11-07" "2008-11-08" "2008-11-09" "2008-11-10"
## [316] "2008-11-11" "2008-11-12" "2008-11-13" "2008-11-14" "2008-11-15"
## [321] "2008-11-16" "2008-11-17" "2008-11-18" "2008-11-19" "2008-11-20"
## [326] "2008-11-21" "2008-11-22" "2008-11-23" "2008-11-24" "2008-11-25"
## [331] "2008-11-26" "2008-11-27" "2008-11-28" "2008-11-29" "2008-11-30"
## [336] "2008-12-01" "2008-12-02" "2008-12-03" "2008-12-04" "2008-12-05"
## [341] "2008-12-06" "2008-12-07" "2008-12-08" "2008-12-09" "2008-12-10"
## [346] "2008-12-11" "2008-12-12" "2008-12-13" "2008-12-14" "2008-12-15"
## [351] "2008-12-16" "2008-12-17" "2008-12-18" "2008-12-19" "2008-12-20"
## [356] "2008-12-21" "2008-12-22" "2008-12-23" "2008-12-24" "2008-12-25"
## [361] "2008-12-26" "2008-12-27" "2008-12-28" "2008-12-29" "2008-12-30"
## [366] "2008-12-31"
```
2008 data covers full year.


*2009*

```r
# get unique values in date
unique(yr2009$Date)
```

```
##   [1] "2009-01-01" "2009-01-02" "2009-01-03" "2009-01-04" "2009-01-05"
##   [6] "2009-01-06" "2009-01-07" "2009-01-08" "2009-01-09" "2009-01-10"
##  [11] "2009-01-11" "2009-01-12" "2009-01-13" "2009-01-14" "2009-01-15"
##  [16] "2009-01-16" "2009-01-17" "2009-01-18" "2009-01-19" "2009-01-20"
##  [21] "2009-01-21" "2009-01-22" "2009-01-23" "2009-01-24" "2009-01-25"
##  [26] "2009-01-26" "2009-01-27" "2009-01-28" "2009-01-29" "2009-01-30"
##  [31] "2009-01-31" "2009-02-01" "2009-02-02" "2009-02-03" "2009-02-04"
##  [36] "2009-02-05" "2009-02-06" "2009-02-07" "2009-02-08" "2009-02-09"
##  [41] "2009-02-10" "2009-02-11" "2009-02-12" "2009-02-13" "2009-02-14"
##  [46] "2009-02-15" "2009-02-16" "2009-02-17" "2009-02-18" "2009-02-19"
##  [51] "2009-02-20" "2009-02-21" "2009-02-22" "2009-02-23" "2009-02-24"
##  [56] "2009-02-25" "2009-02-26" "2009-02-27" "2009-02-28" "2009-03-01"
##  [61] "2009-03-02" "2009-03-03" "2009-03-04" "2009-03-05" "2009-03-06"
##  [66] "2009-03-07" "2009-03-08" "2009-03-09" "2009-03-10" "2009-03-11"
##  [71] "2009-03-12" "2009-03-13" "2009-03-14" "2009-03-15" "2009-03-16"
##  [76] "2009-03-17" "2009-03-18" "2009-03-19" "2009-03-20" "2009-03-21"
##  [81] "2009-03-22" "2009-03-23" "2009-03-24" "2009-03-25" "2009-03-26"
##  [86] "2009-03-27" "2009-03-28" "2009-03-29" "2009-03-30" "2009-03-31"
##  [91] "2009-04-01" "2009-04-02" "2009-04-03" "2009-04-04" "2009-04-05"
##  [96] "2009-04-06" "2009-04-07" "2009-04-08" "2009-04-09" "2009-04-10"
## [101] "2009-04-11" "2009-04-12" "2009-04-13" "2009-04-14" "2009-04-15"
## [106] "2009-04-16" "2009-04-17" "2009-04-18" "2009-04-19" "2009-04-20"
## [111] "2009-04-21" "2009-04-22" "2009-04-23" "2009-04-24" "2009-04-25"
## [116] "2009-04-26" "2009-04-27" "2009-04-28" "2009-04-29" "2009-04-30"
## [121] "2009-05-01" "2009-05-02" "2009-05-03" "2009-05-04" "2009-05-05"
## [126] "2009-05-06" "2009-05-07" "2009-05-08" "2009-05-09" "2009-05-10"
## [131] "2009-05-11" "2009-05-12" "2009-05-13" "2009-05-14" "2009-05-15"
## [136] "2009-05-16" "2009-05-17" "2009-05-18" "2009-05-19" "2009-05-20"
## [141] "2009-05-21" "2009-05-22" "2009-05-23" "2009-05-24" "2009-05-25"
## [146] "2009-05-26" "2009-05-27" "2009-05-28" "2009-05-29" "2009-05-30"
## [151] "2009-05-31" "2009-06-01" "2009-06-02" "2009-06-03" "2009-06-04"
## [156] "2009-06-05" "2009-06-06" "2009-06-07" "2009-06-08" "2009-06-09"
## [161] "2009-06-10" "2009-06-11" "2009-06-12" "2009-06-13" "2009-06-15"
## [166] "2009-06-16" "2009-06-17" "2009-06-18" "2009-06-19" "2009-06-20"
## [171] "2009-06-21" "2009-06-22" "2009-06-23" "2009-06-24" "2009-06-25"
## [176] "2009-06-26" "2009-06-27" "2009-06-28" "2009-06-29" "2009-06-30"
## [181] "2009-07-01" "2009-07-02" "2009-07-03" "2009-07-04" "2009-07-05"
## [186] "2009-07-06" "2009-07-07" "2009-07-08" "2009-07-09" "2009-07-10"
## [191] "2009-07-11" "2009-07-12" "2009-07-13" "2009-07-14" "2009-07-15"
## [196] "2009-07-16" "2009-07-17" "2009-07-18" "2009-07-19" "2009-07-20"
## [201] "2009-07-21" "2009-07-22" "2009-07-23" "2009-07-24" "2009-07-25"
## [206] "2009-07-26" "2009-07-27" "2009-07-28" "2009-07-29" "2009-07-30"
## [211] "2009-07-31" "2009-08-01" "2009-08-02" "2009-08-03" "2009-08-04"
## [216] "2009-08-05" "2009-08-06" "2009-08-07" "2009-08-08" "2009-08-09"
## [221] "2009-08-10" "2009-08-11" "2009-08-12" "2009-08-13" "2009-08-14"
## [226] "2009-08-15" "2009-08-16" "2009-08-17" "2009-08-18" "2009-08-19"
## [231] "2009-08-20" "2009-08-21" "2009-08-22" "2009-08-23" "2009-08-24"
## [236] "2009-08-25" "2009-08-26" "2009-08-27" "2009-08-28" "2009-08-29"
## [241] "2009-08-30" "2009-08-31" "2009-09-01" "2009-09-02" "2009-09-03"
## [246] "2009-09-04" "2009-09-05" "2009-09-06" "2009-09-07" "2009-09-08"
## [251] "2009-09-09" "2009-09-10" "2009-09-11" "2009-09-12" "2009-09-13"
## [256] "2009-09-14" "2009-09-15" "2009-09-16" "2009-09-17" "2009-09-18"
## [261] "2009-09-19" "2009-09-20" "2009-09-21" "2009-09-22" "2009-09-23"
## [266] "2009-09-24" "2009-09-25" "2009-09-26" "2009-09-27" "2009-09-28"
## [271] "2009-09-29" "2009-09-30" "2009-10-01" "2009-10-02" "2009-10-03"
## [276] "2009-10-04" "2009-10-05" "2009-10-06" "2009-10-07" "2009-10-08"
## [281] "2009-10-09" "2009-10-10" "2009-10-11" "2009-10-12" "2009-10-13"
## [286] "2009-10-14" "2009-10-15" "2009-10-16" "2009-10-17" "2009-10-18"
## [291] "2009-10-19" "2009-10-20" "2009-10-21" "2009-10-22" "2009-10-23"
## [296] "2009-10-24" "2009-10-25" "2009-10-26" "2009-10-27" "2009-10-28"
## [301] "2009-10-29" "2009-10-30" "2009-10-31" "2009-11-01" "2009-11-02"
## [306] "2009-11-03" "2009-11-04" "2009-11-05" "2009-11-06" "2009-11-07"
## [311] "2009-11-08" "2009-11-09" "2009-11-10" "2009-11-11" "2009-11-12"
## [316] "2009-11-13" "2009-11-14" "2009-11-15" "2009-11-16" "2009-11-17"
## [321] "2009-11-18" "2009-11-19" "2009-11-20" "2009-11-21" "2009-11-22"
## [326] "2009-11-23" "2009-11-24" "2009-11-25" "2009-11-26" "2009-11-27"
## [331] "2009-11-28" "2009-11-29" "2009-11-30" "2009-12-01" "2009-12-02"
## [336] "2009-12-03" "2009-12-04" "2009-12-05" "2009-12-06" "2009-12-07"
## [341] "2009-12-08" "2009-12-09" "2009-12-10" "2009-12-11" "2009-12-12"
## [346] "2009-12-13" "2009-12-14" "2009-12-15" "2009-12-16" "2009-12-17"
## [351] "2009-12-18" "2009-12-19" "2009-12-20" "2009-12-21" "2009-12-22"
## [356] "2009-12-23" "2009-12-24" "2009-12-25" "2009-12-26" "2009-12-27"
## [361] "2009-12-28" "2009-12-29" "2009-12-30" "2009-12-31"
```
2009 data covers full year.


*2010*

```r
# get unique values in date
unique(yr2010$Date)
```

```
##   [1] "2010-01-01" "2010-01-02" "2010-01-03" "2010-01-04" "2010-01-05"
##   [6] "2010-01-06" "2010-01-07" "2010-01-08" "2010-01-09" "2010-01-10"
##  [11] "2010-01-11" "2010-01-12" "2010-01-14" "2010-01-15" "2010-01-16"
##  [16] "2010-01-17" "2010-01-18" "2010-01-19" "2010-01-20" "2010-01-21"
##  [21] "2010-01-22" "2010-01-23" "2010-01-24" "2010-01-25" "2010-01-26"
##  [26] "2010-01-27" "2010-01-28" "2010-01-29" "2010-01-30" "2010-01-31"
##  [31] "2010-02-01" "2010-02-02" "2010-02-03" "2010-02-04" "2010-02-05"
##  [36] "2010-02-06" "2010-02-07" "2010-02-08" "2010-02-09" "2010-02-10"
##  [41] "2010-02-11" "2010-02-12" "2010-02-13" "2010-02-14" "2010-02-15"
##  [46] "2010-02-16" "2010-02-17" "2010-02-18" "2010-02-19" "2010-02-20"
##  [51] "2010-02-21" "2010-02-22" "2010-02-23" "2010-02-24" "2010-02-25"
##  [56] "2010-02-26" "2010-02-27" "2010-02-28" "2010-03-01" "2010-03-02"
##  [61] "2010-03-03" "2010-03-04" "2010-03-05" "2010-03-06" "2010-03-07"
##  [66] "2010-03-08" "2010-03-09" "2010-03-10" "2010-03-11" "2010-03-12"
##  [71] "2010-03-13" "2010-03-14" "2010-03-15" "2010-03-16" "2010-03-17"
##  [76] "2010-03-18" "2010-03-19" "2010-03-20" "2010-03-21" "2010-03-22"
##  [81] "2010-03-23" "2010-03-24" "2010-03-25" "2010-03-26" "2010-03-27"
##  [86] "2010-03-28" "2010-03-29" "2010-03-30" "2010-03-31" "2010-04-01"
##  [91] "2010-04-02" "2010-04-03" "2010-04-04" "2010-04-05" "2010-04-06"
##  [96] "2010-04-07" "2010-04-08" "2010-04-09" "2010-04-10" "2010-04-11"
## [101] "2010-04-12" "2010-04-13" "2010-04-14" "2010-04-15" "2010-04-16"
## [106] "2010-04-17" "2010-04-18" "2010-04-19" "2010-04-20" "2010-04-21"
## [111] "2010-04-22" "2010-04-23" "2010-04-24" "2010-04-25" "2010-04-26"
## [116] "2010-04-27" "2010-04-28" "2010-04-29" "2010-04-30" "2010-05-01"
## [121] "2010-05-02" "2010-05-03" "2010-05-04" "2010-05-05" "2010-05-06"
## [126] "2010-05-07" "2010-05-08" "2010-05-09" "2010-05-10" "2010-05-11"
## [131] "2010-05-12" "2010-05-13" "2010-05-14" "2010-05-15" "2010-05-16"
## [136] "2010-05-17" "2010-05-18" "2010-05-19" "2010-05-20" "2010-05-21"
## [141] "2010-05-22" "2010-05-23" "2010-05-24" "2010-05-25" "2010-05-26"
## [146] "2010-05-27" "2010-05-28" "2010-05-29" "2010-05-30" "2010-05-31"
## [151] "2010-06-01" "2010-06-02" "2010-06-03" "2010-06-04" "2010-06-05"
## [156] "2010-06-06" "2010-06-07" "2010-06-08" "2010-06-09" "2010-06-10"
## [161] "2010-06-11" "2010-06-12" "2010-06-13" "2010-06-14" "2010-06-15"
## [166] "2010-06-16" "2010-06-17" "2010-06-18" "2010-06-19" "2010-06-20"
## [171] "2010-06-21" "2010-06-22" "2010-06-23" "2010-06-24" "2010-06-25"
## [176] "2010-06-26" "2010-06-27" "2010-06-28" "2010-06-29" "2010-06-30"
## [181] "2010-07-01" "2010-07-02" "2010-07-03" "2010-07-04" "2010-07-05"
## [186] "2010-07-06" "2010-07-07" "2010-07-08" "2010-07-09" "2010-07-10"
## [191] "2010-07-11" "2010-07-12" "2010-07-13" "2010-07-14" "2010-07-15"
## [196] "2010-07-16" "2010-07-17" "2010-07-18" "2010-07-19" "2010-07-20"
## [201] "2010-07-21" "2010-07-22" "2010-07-23" "2010-07-24" "2010-07-25"
## [206] "2010-07-26" "2010-07-27" "2010-07-28" "2010-07-29" "2010-07-30"
## [211] "2010-07-31" "2010-08-01" "2010-08-02" "2010-08-03" "2010-08-04"
## [216] "2010-08-05" "2010-08-06" "2010-08-07" "2010-08-08" "2010-08-09"
## [221] "2010-08-10" "2010-08-11" "2010-08-12" "2010-08-13" "2010-08-14"
## [226] "2010-08-15" "2010-08-16" "2010-08-17" "2010-08-22" "2010-08-23"
## [231] "2010-08-24" "2010-08-25" "2010-08-26" "2010-08-27" "2010-08-28"
## [236] "2010-08-29" "2010-08-30" "2010-08-31" "2010-09-01" "2010-09-02"
## [241] "2010-09-03" "2010-09-04" "2010-09-05" "2010-09-06" "2010-09-07"
## [246] "2010-09-08" "2010-09-09" "2010-09-10" "2010-09-11" "2010-09-12"
## [251] "2010-09-13" "2010-09-14" "2010-09-15" "2010-09-16" "2010-09-17"
## [256] "2010-09-18" "2010-09-19" "2010-09-20" "2010-09-21" "2010-09-22"
## [261] "2010-09-23" "2010-09-24" "2010-09-25" "2010-09-28" "2010-09-29"
## [266] "2010-09-30" "2010-10-01" "2010-10-02" "2010-10-03" "2010-10-04"
## [271] "2010-10-05" "2010-10-06" "2010-10-07" "2010-10-08" "2010-10-09"
## [276] "2010-10-10" "2010-10-11" "2010-10-12" "2010-10-13" "2010-10-14"
## [281] "2010-10-15" "2010-10-16" "2010-10-17" "2010-10-18" "2010-10-19"
## [286] "2010-10-20" "2010-10-21" "2010-10-22" "2010-10-23" "2010-10-24"
## [291] "2010-10-25" "2010-10-26" "2010-10-27" "2010-10-28" "2010-10-29"
## [296] "2010-10-30" "2010-10-31" "2010-11-01" "2010-11-02" "2010-11-03"
## [301] "2010-11-04" "2010-11-05" "2010-11-06" "2010-11-07" "2010-11-08"
## [306] "2010-11-09" "2010-11-10" "2010-11-11" "2010-11-12" "2010-11-13"
## [311] "2010-11-14" "2010-11-15" "2010-11-16" "2010-11-17" "2010-11-18"
## [316] "2010-11-19" "2010-11-20" "2010-11-21" "2010-11-22" "2010-11-23"
## [321] "2010-11-24" "2010-11-25" "2010-11-26"
```
2010 data only covers through November 26.

-->

Tasks Performed:
- cleaned variable names
- merged the 3 yearly datasets
- renamed obliquely named variables
- create POSIXCT date variable from year, month, day, and time columns
- turn dataframe into tsibble (Tsibbles are an extension of the tibble data form. Tibbles are similar to dataframes, but they have more structure/impose more constraints.)
- fill date-time gaps (Data documentation reports 1.25% of observations are missing, and missing values are represented by blanks (gaps). Time series analysis/forcasting requires time interval with no gaps)
- reduce data granularity (the dataset contains 1 reading per minute for each submeter and covers a 3 year timespan (aprox. 4.73 million readings). That level of granularity is unnecessary for this project, and it would make sense to use a subset of those readings (e.g. 1 reading from each submeter every 10 min.). That can be accomplished by filtering the data.

<!--
## *Join 2007-09 Datasets*

```r
# make var names uniform
yr2007 <- clean_names(yr2007)
yr2008 <- clean_names(yr2008)
yr2009 <- clean_names(yr2009)

# merge 2007-2009 datasets
yrs2007_2009 <- bind_rows(yr2007, yr2008, yr2009)
```


## *Rename Variables*

```r
yrs2007_2009 <- yrs2007_2009 %>%
  rename(kitchen = sub_metering_1) %>%
  rename(laundry = sub_metering_2) %>%
  rename(AC = sub_metering_3)

glimpse(yrs2007_2009)
---
## Rows: 1,569,894
## Columns: 5
## $ date    <chr> "2007-01-01", "2007-01-01", "2007-01-01", "2007-01-01", "2007-~
## $ time    <chr> "00:00:00", "00:01:00", "00:02:00", "00:03:00", "00:04:00", "0~
## $ kitchen <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,~
## $ laundry <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,~
## $ AC      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,~
```


## *Create Date-Time Variable* #########################

-->

```r
# create new column uniting date and time, converr to posixct
yrs2007_2009 <- yrs2007_2009 %>%
  mutate(date_time = paste(yrs2007_2009$date,
                           yrs2007_2009$time)) %>%
  mutate(date_time = ymd_hms(date_time))
```

<!--
>*Notes on Adding Time Zone*
- POA says to add Paris timezone, but I don't think including time zone would add anything to this analysis (and working with time zoned values is much harder)
  + To add Paris time zone use `mutate(date_time = force_tz(date_time, tzone = "Europe/Paris"))`
- Use `OlsonNames()` to get list of timezones on your machine.
- `force_tz()` will add time zone to date_time object without changing the clock time and altering the times in your data.
- `with_tz()` changes the time zone and updates the clock time to align with the updated time zone--this may alter the time values in your data.
-->

```r
# remove columns, reshape from wide to long, coerce tsibble
yrs_tsb <- yrs2007_2009 %>%
  select(-date, -time) %>%
  pivot_longer(names_to = "submeter",
               values_to = "reading",
               kitchen:AC) %>%
  as_tsibble(key = submeter,
            index = date_time,
            validate = TRUE)
```

```r
#count gaps
yrs_tsb %>%
  count_gaps()

#fill implicit missing values with 0
yrs_tsb <- yrs_tsb %>%
  fill_gaps(reading = 0)
```



&nbsp;
## DATA EXPLORATION (EDA) ###########################################

### *Daily Analysis*
It may be illuminating to zoom in on a single day and examine the pattern of individual readings (instead of averages) from each submeter throught the day.


```r
# plot readings for Jan. 9, 2008
yrs_tsb %>%
  filter_index("2008-01-09") %>%
  autoplot(reading) +
  ggtitle("Submeter Readings for January 9, 2008") +
  labs(x = " ", y = "Submeter Reading (watt-hours)")
```

{{< figure src="/images/unnamed-chunk-25-1.png" >}}

```r
# get avg. readings on Jan 9, 2008 using subset
yrs_tsb %>%
  filter(minute(date_time) %in% c(0, 10, 20, 30, 40, 50)) %>%
  index_by(janday = as_date('20080109')) %>%
  group_by_key() %>%
  summarise(avg_reading = mean(reading))
---
## # A tsibble: 3 x 3 [?]
## # Key:       submeter [3]
##   submeter janday     avg_reading
##   <chr>    <date>           <dbl>
## 1 AC       2008-01-09        6.19
## 2 kitchen  2008-01-09        1.16
## 3 laundry  2008-01-09        1.33
```

<!--
```r
yrs_tsb %>%
  filter(minute(date_time) %in% c(0, 10, 20, 30, 40, 50)) %>%
  filter_index("2008-01-09") %>%
  autoplot(reading)+
  labs(title = "Submeter Readings for January 9, 2008",
       x = "",
       y = "Reading (Watt/Hour)")
```

![](c4t1-kp-energy-comsumption-project-research-data-understanding_files/figure-html/unnamed-chunk-28-1.png)

>*Notes*
>
- The plot above was generated from readings at 10 min. intervals.
- Given that we are only looking at a single day, reducing the granularity of the dataset seems unnecessary and does not reveal any additional information.
-->



&nbsp;
### Weekly Analysis

```r
# plot weekly avg readings
yrs_tsb %>%
  group_by_key() %>%
  index_by(yearweek = yearweek(date_time)) %>%
  summarize(avg_reading = mean(reading)) %>%
  autoplot(avg_reading) +
  ggtitle("Weekly Average Reading")+
  labs(x = " ", y = "Submeter Reading (watt-hour)")
```

{{< figure src="/images/unnamed-chunk-29-1.png" >}}

*Observations*
- Not surprisingly, the submeter monitoring energy usage for the AC and water heater in the home consistently has a much higher average reading than the other two submeters—indicating that the AC and water heater units account for a significant proportion of the total energy usage in the home.  
- Appears to be some seasonality in the energy usage, esp. for the submeter monitoring AC and water heater usage. But the data is a bit too noisey. Let's look at the monthly average readings to see if we can get more insight.

<!--
Let's look at the energy usage over the first full week (Mon - Sun) in April 2008. (insert: 2008 Calendar partial_2008_cal.png) Since the full dataset contains over 30,000 observations for that time period, using all the data points would make the graph too crowded--so it make sense to use the 10 min subset here.


```r
# plot submeter readings for April 9-13, 2008 using subset
yrs_tsb %>%
  filter(minute(date_time) %in% c(0, 10, 20, 30, 40, 50)) %>%
  filter_index("2008-04-07" ~ "2008-04-13") %>%
  autoplot(reading) +
  ggtitle("Submeter Readings for April 7-13, 2008")+
  labs(x = " ", y = "Submeter Reading" )
```

{{< figure src="/images/unnamed-chunk-30-1.png" >}}
-->



&nbsp;
## Monthly Analysis

```r
# plot monthly avg reading
yrs_tsb %>%
  group_by_key() %>%
  index_by(year_month = yearmonth(date_time)) %>%
  summarize(avg_reading = mean(reading)) %>%
  ggplot(aes(x = year_month,
             y = avg_reading,
             color = submeter))+
  geom_line() +
  labs(title = "Monthly Average Submeter Readings (2007-2009)",
       x = " ",
       y = "Average Reading (watt-hour)")
```

{{< figure src="/images/unnamed-chunk-31-1.png" >}}

>*Observations*
>- The plot of monthly average readings has the same basic pattern we saw with the plot of weekly average readings.
>- But this plot shows the seasonaility more clearly, and also appears to show an unusual dip in energy usage in all three submeters sometime in the sum


<!--
&nbsp;
## Nonstandard Periods

In addition to visualizing the data in regular periods (e.g. days, weeks, months, years), it may also be appropriate to look at non-standard intervals. The next plot is of the readings for submeter 3 (AC and water heater) only on Mondays at 8PM from 2007-2009.


```r
# plot readings for mondays at 8pm
yrs_tsb %>%
  filter(weekdays(date_time) %in% "Monday") %>%
  filter(hour(date_time) %in% 20) %>%
  filter(minute(date_time) %in% 01) %>%
  filter(submeter == "AC") %>%
  autoplot(reading) +
  labs(title = 'AC Submeter Readings for Mondays at 8PM',
       x = "", y = 'Reading (watt-hours)')
```

{{< figure src="/images/unnamed-chunk-32-1.png" >}}




&nbsp;
## Seasonality Analysis

```r
yrs_tsb %>%
  group_by_key() %>%
  index_by(day = ~lubridate::as_date(.)) %>%
  gg_season(reading, period = "month")
```

{{< figure src="/images/unnamed-chunk-33-1.png" >}}
-->



### Daily Average

```r
#seasonal plot for 2007
yrs_tsb %>%
  filter(year(date_time) == '2007') %>%
  group_by_key() %>%
  index_by(day = ~lubridate::as_date(.)) %>%
  summarise(day_avg = mean(reading)) %>%
  ungroup() %>%
  gg_season(day_avg)+
  ggtitle("2007 Daily Average Reading")
```

{{< figure src="/images/unnamed-chunk-34-1.png" >}}
{{< figure src="/images/unnamed-chunk-35-1.png" >}}
{{< figure src="/images/unnamed-chunk-36-1.png" >}}


<!--
```r
# seasonal plot for 2008
yrs_tsb %>%
  filter(year(date_time) == '2008') %>%
  group_by_key() %>%
  index_by(day = ~lubridate::as_date(.)) %>%
  summarise(day_avg = mean(reading)) %>%
  ungroup() %>%
  gg_season(day_avg) +
  ggtitle("2008 Daily Average Reading")
```


```r
# seasonal plot for 2009
yrs_tsb %>%
  filter(year(date_time) == '2009') %>%
  group_by_key() %>%
  index_by(day = ~lubridate::as_date(.)) %>%
  summarise(day_avg = mean(reading)) %>%
  gg_season(day_avg) +
  ggtitle("2009 Daily Average Reading")
```
-->


*Observations*
- In the daily average seasonality plots for 2008, there is a distict and prolonged trough in energy usage which appears to be sometime August or September. That could indicate a span of time when there was no one occupying the house.
- Comparing 2008 to 2007 and 2009, the trough in 2008 is, indeed, unusual.
- There also seem to be some monthly and seasonality trends in energy use in all three years.



&nbsp;
### Monthly Average

```r
# plot monthly avg. reading over time
yrs_tsb %>%
  index_by(yearmonth(date_time)) %>%
  summarize(avg_reading = mean(reading))%>%
  gg_season(avg_reading)
```

{{< figure src="/images/unnamed-chunk-37-1.png" >}}

*Observations*
- Looking at a seasonal plot of monthly averages, it is apparent that August 2008 had the lowest average AC usage of any month during the three year timespan.
- However, it should be noted that the August 2008 average is perhaps only 0.5 watt-hours below the July average in 2009.





&nbsp;
## FORECASTING #############################################

<!--
Create forcast for submeter 3 (AC), 20 time periods ahead

```r
# create tsibble
s3_1x_wk <-  yrs2007_2009 %>%
  filter(weekdays(date_time) %in% "Monday") %>%
  filter(hour(date_time) %in% 20) %>%
  filter(minute(date_time) %in% 01) %>%
  pivot_longer(names_to = "submeter",
               values_to = "reading",
               kitchen:AC) %>%
  select(date, submeter, reading) %>%
  filter(submeter == "AC") %>%
  mutate(date = ymd(date)) %>%
  as_tsibble(key = submeter, index = date, validate = TRUE)

# plot
s3_1x_wk %>% autoplot(reading)
```

{{< figure src="/images/unnamed-chunk-39-1.png" >}}


```r
fit_s3 <-  s3_1x_wk %>%
  model(TSLM(reading ~ trend()))

#create forecast
fit_s3 %>%
  forecast(h = "20 weeks") %>%
  autoplot(s3_1x_wk)
```

{{< figure src="/images/unnamed-chunk-40-1.png" >}}
-->


```r
#fit seasonal naive model
fit_s301 <-  s3_1x_wk %>%
  model(SNAIVE(reading ~ lag(7)))

#create forecast and plot
fit_s301 %>%
  forecast(h = "20 weeks") %>%
  autoplot(s3_1x_wk)
```

{{< figure src="/images/unnamed-chunk-41-1.png" >}}


```r
# fit stl decomp model
my_dcmp_spec <- decomposition_model(
  STL(reading),
  ETS(season_adjust ~ season("N"))
)

#create forecast and plot
s3_1x_wk %>%
  model(stl_ets = my_dcmp_spec) %>%
  forecast(h = "20 weeks") %>%
  autoplot(s3_1x_wk)
```


{{< figure src="/images/unnamed-chunk-42-1.png" >}}



<!--
&nbsp;
## Faorecast Weekly Averages for 2008

```r
# create tsibble of daily avgs for 2008
daily_avg_08 <- yrs_tsb %>%
  filter(year(date_time) == '2008') %>%
  group_by_key() %>%
  index_by(day = ~lubridate::as_date(.)) %>%
  summarise(day_avg = mean(reading)) %>%
  as_tsibble(key = submeter, index = day)
```


```r
fit_daily08 <-  daily_avg_08 %>%
  model(ETS(day_avg))

#create forecast and plot
fit_daily08 %>%
  forecast(h = "10 weeks") %>%
  autoplot(daily_avg_08)
```

{{< figure src="/images/unnamed-chunk-44-1.png" >}}
-->




&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [Link to GitHub Repository](https://github.com/kpiatti/energy-consumption-timeseries)
